#!/bin/bash

# author: Chat GPT
# This script has been generated by ChatGPT with slight modifications by marcsieber.
# Shell script to wrap and call the Python script, later download the official input samples.

# Assign arguments to variables
# Default year if not provided as an argument
DEFAULT_YEAR="2024"

# Check if a year is provided as the first argument
if [[ -n "$2" ]]; then
    YEAR="$2"
else
    YEAR="$DEFAULT_YEAR"
fi
DAY=$1
DAY_PADDED=$(printf "%02d" $DAY)

# Define the URL and cookie file
URL="https://adventofcode.com/$YEAR/day/$DAY/input"
COOKIE_FILE="session-cookie.txt"
OUTPUT_FILE="src/main/resources/$YEAR/provided/day$DAY_PADDED.txt"

# Check if the correct number of arguments is provided
if [ "$#" -ne 1 ]; then
  if [ "$#" -ne 2 ]; then
    echo "Usage: ./adddday <day> <year> (optional)"
    exit 1
  fi
fi

# Check if the cookie file exists
if [[ ! -f "$COOKIE_FILE" ]]; then
    echo "Error: Session cookie file ($COOKIE_FILE) not found."
    exit 1
fi

# Call the Python script with the provided arguments
python3 addday.py "$DAY" "$YEAR"

# Check the exit status of the Python script
if [ $? -eq 0 ]; then
    echo "Advent of Code structure created successfully for Day $DAY."
else
    echo "Failed to create the structure. Check the error messages above."
fi

# Read the session cookie from the file
SESSION_COOKIE=$(cat "$COOKIE_FILE")

# Download the input using curl
curl -s -H "Cookie: session=$SESSION_COOKIE" "$URL" -o "$OUTPUT_FILE"

# Check if the download was successful
if [[ $? -eq 0 ]]; then
    echo "Input downloaded successfully to $OUTPUT_FILE."
else
    echo "Error: Failed to download input."
    exit 1
fi
